## APEX动手实验1(数据上传、IR+IG、图表)

### Workshop 概述

本次研讨会将带您使用Apex数据上传、数据分析等功能，从0开始逐步创建完成。

预计时间：3小时以内



### 目录

- Lab1 - 数据上传
- Lab2 - 销售数据分析(IR+IG)
- Lab3 - 销售数据分析(Chart)



备注:本次workshop的Lab1和Lab2是连着的，在Lab1上传销售数据，然后在Lab2中对Lab1上传的销售数据进行分析。另外，关于数据上传的文件，我们会提供给大家，用于本次的hands-on。

下记为数据文件的示例数据[销售数据_DataUpload.xlsx]。

![image-20230216190654620](images/image-20230216190654620.png)

****

****

### Lab 1 - 数据上传

简介

Apex数据上传....通过复制和粘贴 CSV 数据、选择示例数据集或上传文件，将数据加载到Oracle APEX 。本次hands-on使用Excel上传数据文件。

将数据加载到APEX时的主要功能包括：

- 复制并粘贴 CSV 数据，或选择样本数据集。
- 上传文件（支持 CSV、XLSX、TXT、XML 或 JSON 文件）。

****

#### 任务1：开发者数据上传

点击‘SQL工作室 ->实用程序-> 数据工作室’ - (New Table 或 Existing Table)。

![image-20221227150631433](images/image-20221227150631433.png)

在数据工作室中，点击’数据加载‘。

![image-20221227150732705](images/image-20221227150732705.png)

点击’选择文件‘，选择'销售分析.xlxs'文件。

![image-20221227150811726](images/image-20221227150811726.png)

在表名处设置目标表，填写新表名或选择现有表，配置完成后点击'数据加载'按钮。

※在此处...请大家在‘表名’处添加自己的前缀进行标识，如：XX_SALES_DATA_UPLOAD。

![image-20230213163025937](images/image-20230213163025937.png)

数据加载完成如下所示。

![image-20230213163952515](images/image-20230213163952515.png)



****

#### 任务2：最终用户数据上传

提供数据加载向导，最终用户可在界面上自行导入。

最终用户数据加载方法的有三种(附加、合并、替换)，设置该方法需数据模板创建完成后，在当前模板中设置。

附加(默认)  →      将行附加到表中。（insert）

合并：         →     将行合并到表中，必须为数据模板必须定义主键才能使用此选项。(insert/update)

替换：         →     加载新数据之前，将删除目标表或集合中的现有数据，然后再插入数据。(delete/insert)

##### ①创建应用程序

点击‘创建按钮’，创建Apex应用程序。

![image-20221227160558772](images/image-20221227160558772.png)

选择‘新建应用程序’。

![image-20221227160614052](images/image-20221227160614052.png)

点击'创建应用程序'。

![image-20230217142525028](images/image-20230217142525028.png)



##### ②定义数据加载模板

应用程序创建完成后，点击‘共享组件’。

![image-20230217142632222](images/image-20230217142632222.png)

在数据源中点击‘数据加载定义’。

![image-20221227161443644](images/image-20221227161443644.png)

点击‘创建’按钮，创建数据加载模板。

![image-20221227161544807](images/image-20221227161544807.png)

在创建数据加载画面，选择‘从头开始’，然后点击’下一步‘。

![image-20221227161647591](images/image-20221227161647591.png)

选择数据上传目标表，然后点击’下一步‘。选择Lab1-任务1中的表名。

![image-20230213164759773](images/image-20230213164759773.png)

选择数据加载模板Excel文件后，然后点击’下一步‘。

![image-20230213164909463](images/image-20230213164909463.png)

配置映射列(此处...可修改列的映射关系)，然后点击’创建并添加页‘。

![image-20230213165302470](images/image-20230213165302470.png)



##### ③创建数据上传页

在②中点击’创建并添加页‘按钮后，会跳转到’文件上传‘向导页，然后点击‘创建页’。

![image-20230213165546384](images/image-20230213165546384.png)

页面创建成功后，如下所示，点击运行画面。

![image-20230213165650852](images/image-20230213165650852.png)

输入个人的Apex用户/密码，点击登录即可。

![image-20230213165707054](images/image-20230213165707054.png)

画面运行结果如下所示。

![image-20230213165735189](images/image-20230213165735189.png)



##### ④数据上传测试

事前查询XX_SALES_DATA_UPLOAD表中数据条数，或删除表中的数据。

※路径：'SQL工作室'->'SQL命令'。

```sql
SELECT COUNT(1) FROM wb_sales_data_upload;
```

![image-20230213170125430](images/image-20230213170125430.png)



数据件数确认后，返回销售数据上传画面，点击’选择文件‘按钮，上传数据文件。

![image-20230213170724105](images/image-20230213170724105.png)



数据文件选择后，点击’数据加载‘按钮把数据上传到Apex中。

![image-20230213171001554](images/image-20230213171001554.png)

如下所示，数据上传成功。

![image-20230213171510266](images/image-20230213171510266.png)

接下来...返回‘SQL工作室'->'SQL命令'中，使用SQL....查询XX_SALES_DATA_UPLOAD表中的数据件数。

![image-20230213171425111](images/image-20230213171425111.png)



如之前所说，Apex中最终用户数据上传方法的有三种(附加、合并、替换)，上记演示的为附加，数据文件Excel中存在20条数据，上传成功后...在DB中可发现这20条数据，如再次点击上传Excel数据文件，那么报表则会增加到40条数据。剩余的合并、替换大家可以尝试一下。



***

#### 概况

这样就完成了Lab1，您现在知道如何在Apex中上传数据。



***

***

### Lab 2 - 销售数据分析(IR+IG)

简介

在Apex中存在IR(交互式报表)、IG(交互式网格)和chart都可以对数据进行分析。

如：

IR、IG   →  筛选、过滤、高亮、Chart、分段控制。

Chart    →  条形图、面积图、折线图、饼图........等等等。

接下来我们一起动手，看一下Apex的图表数据分析能力。

****



#### 任务1：交互式报表(IR)

 ※交互式报表数据分析

##### ①创建交互式报表画面

![image-20230213171919974](images/image-20230213171919974.png)

选择‘交互式报表’，然后点击’下一步‘。

![image-20230213171955000](images/image-20230213171955000.png)

画面名称输入后，数据源选择Lab1-任务1中对应的表名。

![image-20230213172133989](images/image-20230213172133989.png)

画面创建成功后，如下所示，点击’运行‘。

![image-20230213172221642](images/image-20230213172221642.png)

##### ②交互式报表演示

**•Column 列**

Column 列...可以隐藏报表列，或者修改报表列的显示顺序。

![image-20230213174228901](images/image-20230213174228901.png)



**•Filter 过滤器**

Filter 过滤器...可按照一定的过滤条件过滤数据。

![image-20230213174338854](images/image-20230213174338854.png)

![image-20230213174419420](images/image-20230213174419420.png)



**•Compute 数据 -> 计算**

 计算...使用计算功能，可以添加新的计算列。

![image-20230213174635623](images/image-20230213174635623.png)

![image-20230213174755988](images/image-20230213174755988.png)



**•格式 -> 控制分段**

控制分段...可把同一类数据归类在一起显示。

![image-20230213181517213](images/image-20230213181517213.png)



**•格式 -> 突出显示**

![image-20230213175004024](images/image-20230213175004024.png)

![image-20230213175126570](images/image-20230213175126570.png)



**•Chart 图表**

![image-20230213175411533](images/image-20230213175411533.png)

![image-20230213175437220](images/image-20230213175437220.png)


**•交叉报表**

交叉报表...是行、列方向都有分组的报表。

![image-20230213175717029](images/image-20230213175717029.png)

![image-20230213175741378](images/image-20230213175741378.png)



•Primary/Private/Public report 默认主报表/专用/公共报表

保存私有报表![image-20230213175844430](images/image-20230213175844430.png)

保存默认报表![image-20230213180048341](images/image-20230213180048341.png)

保存公共报表

※保存公共报表前提条件 => 在编辑页中找到报表，点击属性，然后在属性中开启‘报表保存公共报表’功能。开启后即可保存公共报表。



**•Download 下载**

下载...可把报表当前显示内容下载到本地。

![image-20230213180557165](images/image-20230213180557165.png)



**•订阅**

订阅...开启订阅功能后，可按照所设置的频率（每天/每周/每月）把报表信息发送到您的邮箱。

![image-20230213180741253](images/image-20230213180741253.png)



****

#### 任务2：交互式网格(IG)

 ※交互式网格的数据分析和交互式报表的数据分析一致，详细请参照任务1。

##### ①创建交互式网格画面

备注：详细参照Lab2 -> 任务1 -> ①，在创建画面向导时，选择交互式网格即可。

##### ②交互式网格演示

备注：详细参照Lab2 -> 任务1 -> ②。



####  任务3：IG、IR增删改查

##### ①交互式网格(IG)支持CRUD。

![image-20230216184641884](images/image-20230216184641884.png)

##### ②交互式报表(IR)不支持CUD。

![image-20230216185350909](images/image-20230216185350909.png)

注意：为IR报表添加Form表单后，就可以开启CUD功能。

![image-20230216185135487](images/image-20230216185135487.png)

![image-20230216185227335](images/image-20230216185227335.png)



***

#### 概况

这样就完成了Lab2，您现在知道如何在Apex中使用报表的数据分析。



****

### Lab 3 - 销售数据分析(Chart)

(Lab 3 - 任务1~2)效果图如下所示：

![image-20230214182152854](images/image-20230214182152854.png)

#### 任务1：chart图表(※向导创建)

##### ①每月銷售統計(达标率)

在应用程序页中点击‘创建页’。

##### ![image-20230214163354907](images/image-20230214163354907.png)

在创建页的向导中选择图表，然后点击’下一步‘。

![image-20221228123931194](images/image-20221228123931194.png)

选择‘状态测量仪数据计量表’，点击‘下一步’。

![image-20230214163502841](images/image-20230214163502841.png)

输入任意画面名称后，数据源选择‘SQL查询’。

```plsql
SELECT
  sum(WB_UNIT_PRICE*WB_QUANTITY) sales_total,
  4000000  as  target_total
FROM WB_SALES_DATA_UPLOAD;
```

![image-20230214164221976](images/image-20230214164221976.png)

![image-20230214164439121](images/image-20230214164439121.png)

画面创建完成后，如下所示。点击‘运行’。

![image-20230214164732568](images/image-20230214164732568.png)

画面显示效果如下。

![image-20230214165358183](images/image-20230214165358183.png)

#### 任务2：chart图表(※非向导创建)

##### ①前十大销售

右键点击Body区域，选择’创建区域‘。

![image-20230214174150524](images/image-20230214174150524.png)

把区域名称修改为’前十大销售‘，类型选择’图表‘。

![image-20230214174242464](images/image-20230214174242464.png)

点击区域属性，修改图表类型为’折线图‘。

![image-20230214174802562](images/image-20230214174802562.png)

点击系列，在系列属性中找到源，把’表/试图‘修改为’SQL查询‘。

![image-20230214175004901](images/image-20230214175004901.png)

把下记SQL文放入图表的‘代码编辑器-SQL查询’画面中。放入完成后，点击’确认‘。

```sql
-- 获取前10总销售额。
SELECT * 
FROM( 
    SELECT WB_BUSINESS_ID, 
           sum(WB_UNIT_PRICE*WB_QUANTITY)
    FROM WB_SALES_DATA_UPLOAD
    group by WB_BUSINESS_ID
    order by sum(WB_UNIT_PRICE*WB_QUANTITY) DESC
    )
WHERE ROWNUM <= 10
```

![image-20230214175134771](images/image-20230214175134771.png)

标签设置为业务员ID，值设置为总销售额，设置完成后，点击’运行‘。

![image-20230214175226951](images/image-20230214175226951.png)

画面显示效果如下。

![image-20230214175252738](images/image-20230214175252738.png)



##### ②地区销售

右键点击Body区域，选择’创建区域‘。

![image-20230214175333012](images/image-20230214175333012.png)

把区域名称修改为’地区销售‘，类型选择’图表‘。

![image-20230214175423923](images/image-20230214175423923.png)

点击区域属性，修改图表类型为’饼图‘。

![image-20230214175515510](images/image-20230214175515510.png)

点击系列，在系列属性中找到源，把’表/试图‘修改为’SQL查询‘。

![image-20230214175613543](images/image-20230214175613543.png)

把下记‘SQL文’放入图表的‘代码编辑器-SQL查询’画面中。放入完成后，点击’确认‘。

```sql
-- 获取地区的销售额
SELECT WB_AREA, 
       SUM(WB_UNIT_PRICE * WB_QUANTITY) 
FROM   WB_SALES_DATA_UPLOAD
GROUP BY WB_AREA
ORDER BY WB_AREA;
```

![image-20230214175752753](images/image-20230214175752753.png)

标签设置为厂区，值设置为总销售额，标签显示效果设置为‘标签-百分比’，设置完成后，点击’运行‘。

![image-20230214175905316](images/image-20230214175905316.png)

画面显示效果如下。

![image-20230214180006147](images/image-20230214180006147.png)

##### ③(同产品·不同厂区)销售比较(前10)

右键点击Body区域，选择’创建区域‘。

![image-20230214180341972](images/image-20230214180341972.png)

把区域名称修改为’(同产品·不同厂区)销售比较(前10)‘，类型选择’图表‘。

![image-20230214180436395](images/image-20230214180436395.png)

点击系列，在系列属性中找到源，把’表/试图‘修改为’SQL查询‘。

![image-20230214180538486](images/image-20230214180538486.png)

把下记SQL文放入图表的‘代码编辑器-SQL查询’画面中。放入完成后，点击’确认‘。

```sql
-- 获取同产品不同厂区的总销售额
SELECT * 
FROM (
    SELECT WB_SITE, 
       WB_PRODUCT_CLASS,
       SUM(WB_UNIT_PRICE * WB_QUANTITY) 
    FROM   WB_SALES_DATA_UPLOAD
    GROUP BY WB_SITE,WB_PRODUCT_CLASS
    ORDER BY SUM(WB_UNIT_PRICE * WB_QUANTITY) DESC
)
WHERE ROWNUM <= 10;
```

![image-20230214180919129](images/image-20230214180919129.png)

系列名设置为产品分类，标签设置为厂区，值设置为总销售额。

![image-20230214181102542](images/image-20230214181102542.png)

选择区域，点击属性，在属性中打开图列显示。设置完成后，点击’运行‘。

![image-20230214181204296](images/image-20230214181204296.png)

画面显示效果如下。

![image-20230214181558434](images/image-20230214181558434.png)



温馨提示：上记的Chart图表都是按照顺序从上到下依次排列。如果想要修改Chart图表的排列顺序，只需选中图表区域，在区域中找到是否’开启新行‘，通过该属性...就可以做到让多个图表在一行排列。



****

#### 概况

这样就完成了Lab3，您现在知道如何在Apex中构建图表。
